<!doctype html>
<html lang="pt-br">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Para Sophia ‚Äî Rodrigo</title>
        <!-- Google Font -->
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
        <!-- Bootstrap 5 CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <!-- App styles -->
        <link rel="stylesheet" href="styles.css">
    </head>
    <body class="bg-page">


    <main class="d-flex align-items-center justify-content-center py-5">
            <div class="container px-3">
                <div class="row justify-content-center">
                    <div class="col-12 col-md-8 col-lg-6">
                        <div class="card shadow-sm text-center p-4 card-hero">
                            <div class="profile-circle mx-auto mb-3">
                                <img src="WhatsApp Image 2025-11-07 at 22.17.04.jpeg" alt="Sophia" class="profile-photo" />
                            </div>
                            <h1 class="display-6 fw-bold">Sophia</h1>
                            <p class="lead mb-3">Para voc√™, com todo o meu amor ‚Äî do amor da sua vida</p>

                            <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
                                <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#letterModal">Abrir a carta</button>
                                <button class="btn btn-outline-danger btn-lg" type="button" data-bs-toggle="collapse" data-bs-target="#notesCollapse">Lembretes</button>
                            </div>

                            <div class="collapse mt-3" id="notesCollapse">
                                <div class="card card-body text-start notes">
                                    <ul class="mb-0">
                                        <li>Eu te amo do tamanho do vverso.</li>
                                        <li>Voc√™ me faz mais feliz a cada dia que passa!</li>
                                        <li>Eu te prometo que vamos casar e formar a fam√≠lia mais linda que o mundo j√° viu.</li>
                                    </ul>
                                </div>
                            </div>

                            <footer class="mt-4 medium text-muted">Feito com ü§ç por Rodrigo</footer>
                        </div>
                    </div>
                </div>
            </div>
        </main>

            <!-- Timeline Section -->
            <section class="container px-3 my-3">
                <div class="row justify-content-center">
                    <div class="col-12 col-md-8 col-lg-6">
                        <div class="card shadow-sm p-3 timeline-card">
                            <h5 class="mb-3">Nossa linha do tempo</h5>
                            <p class="small text-muted">Toque em um ponto para ver o momento.</p>

                            <div class="timeline d-flex align-items-center justify-content-between px-2" id="timeline">
                                <!-- pontos ser√£o renderizados via JS a partir de localStorage -->
                            </div>

                            <div class="d-flex justify-content-center mt-3">
                                <button class="btn btn-sm btn-outline-primary" id="addMomentBtn">Adicionar momento</button>
                            </div>
                        </div>
                    </div>
                </div>


            <!-- moment modals ser√£o gerados dinamicamente pelo script a partir dos dados em localStorage -->
        <!-- Letter Modal -->
        <div class="modal fade" id="letterModal" tabindex="-1" aria-labelledby="letterModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="letterModalLabel">Para minha princesa Sophia</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                    </div>
                    <div class="modal-body">
                        <p>Eiiiii amor,</p>
                        <p>Quis criar este cantinho s√≥ pra gente. Eu gostaria de poder fazer muito mais por voc√™ amorzinho, e eu te prometo que vou, mas at√© l√°, eu vou dando um jeitinho KKKKKKKKK</p>
                        <p>E esse √© um jeito de te agradecer, por tudo que voc√™ faz por mim, por toda a ajuda, por cada demonstra√ß√£o de amor e carinho e principalmente por ser quem voc√™ √©!</p>
                        <p>Eu tamb√©m quis criar esse site porque todo lugar que eu tentava te mandar um recadinho era pago, me estressei e pensei: J√° que n√£o tenho como comprar, fa√ßo eu mesmo KKKKKKKKKK</p>
                        <p>Pra resumir √© isso amor, voc√™ pode entrar aqui a hora que quiser, pra lembrar dos nossos momentos juntinhos, espero que voc√™ tenha gostado minha princesa</p>
                        <p>Atenciosamente,<br>Rodrigo </p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    </div>
                </div>
            </div>
        </div>
                <!-- QR / share modal -->
                <div class="modal fade" id="qrModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Compartilhar este site</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                            </div>
                            <div class="modal-body text-center">
                                <p id="qrWarning" class="small text-warning d-none">Observa√ß√£o: este link √© local (file://) e pode n√£o ser acess√≠vel por outras pessoas. Considere publicar em GitHub Pages ou em um servidor.</p>
                                <div class="mb-2">
                                    <input type="text" id="shareUrl" class="form-control text-center" readonly />
                                </div>
                                <div class="mb-3">
                                    <button class="btn btn-outline-secondary btn-sm" id="copyLinkBtn">Copiar link</button>
                                </div>
                                <div id="qrContainer">
                                    <img id="qrImage" alt="QR code" style="max-width:100%;height:auto;border-radius:8px;" />
                                </div>
                            </div>
                            <div class="modal-footer">
                                <a id="downloadQr" class="btn btn-primary" download="qrcode.png">Baixar QR</a>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Modal editar momento (reutiliz√°vel) -->
                <div class="modal fade" id="editMomentModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form id="editMomentForm">
                                <div class="modal-header">
                                    <h5 class="modal-title">Editar momento</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                                </div>
                                <div class="modal-body">
                                    <input type="hidden" id="editMomentId" />
                                    <div class="mb-3">
                                        <label class="form-label">T√≠tulo</label>
                                        <input id="editMomentTitle" class="form-control" maxlength="120" required />
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Descri√ß√£o</label>
                                        <textarea id="editMomentText" class="form-control" rows="4" required></textarea>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">Salvar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
    </section>

                <!-- Mural de fotos -->
                <section class="container px-3 my-3">
                        <div class="row justify-content-center">
                                <div class="col-12 col-md-8 col-lg-6">
                                        <div class="card shadow-sm p-3 timeline-card">
                                                <h5 class="mb-3">Mural de fotos</h5>
                                                <p class="small text-muted">Adicione fotos que ficam salvas no navegador ‚Äî toque para ver ou excluir.</p>

                                                <div id="photoGallery" class="d-flex flex-wrap gap-2"></div>

                                                <div class="d-flex justify-content-center mt-3">
                                                        <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addPhotoModal" id="openAddPhotoBtn">Adicionar foto</button>
                                                </div>
                                        </div>
                                </div>
                        </div>
                </section>

                <!-- Modal adicionar foto -->
                <div class="modal fade" id="addPhotoModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form id="addPhotoForm">
                                <div class="modal-header">
                                    <h5 class="modal-title">Adicionar foto</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <label class="form-label">T√≠tulo (opcional)</label>
                                        <input class="form-control" id="photoTitle" maxlength="100" />
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Escolher imagem</label>
                                        <input type="file" accept="image/*" class="form-control" id="photoFile" required />
                                        <small class="text-muted">A imagem ser√° armazenada localmente no seu navegador (n√£o enviada a nenhum servidor).</small>
                                    </div>
                                    <div id="photoPreview" class="text-center"></div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">Adicionar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Bootstrap JS bundle -->
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            // Persist√™ncia: salvar/carregar momentos com localStorage e renderizar timeline
            (function(){
                const STORAGE_KEY = 'timelineMoments_v1';
                const PHOTO_KEY = 'photoWall_v1';
                const addBtn = document.getElementById('addMomentBtn');
                const timeline = document.getElementById('timeline');

                // sanitize: converte texto cru para HTML seguro com quebras como <br>
                function sanitizeForStorage(raw){
                    const normalized = String(raw || '').replace(/<br\s*\/?>/gi,'\n');
                    return escapeHtml(normalized).replace(/\n/g,'<br>');
                }

                // --- Moments ---
                let moments = loadMoments();
                if(!moments || !moments.length){
                    moments = [
                        { id: genId(), title: 'Primeiro encontro', text: sanitizeForStorage('Lembro do nosso primeiro encontro como se fosse ontem. <br> Quando fomos no m√©qui juntos e voc√™ n√£o queria comer nada KKKKKKKKK <br> Foi um dos melhores dias com voc√™.') },
                        { id: genId(), title: 'Dia do outback', text: sanitizeForStorage('N√£o foi nem o primeiro nem o nosso ultimo encontro, mas sinceramente, foi o mais marcante, porque foi a primeira vez q andamos de m√£os dadas, que ficamos abra√ßadinhos e andamos de carro juntos tbm') },
                        { id: genId(), title: 'Primeiro Beijo', text: sanitizeForStorage('O momento que minha mente explodiu, o momento que eu percebi que √© com voc√™ que eu vou passar o resto da minha vida, o momento que nossa conex√£o se tornou forte o bastante pra nunca mais ser quebrada') }
                    ];
                    saveMoments(moments);
                } else {
                    // normaliza textos j√° salvos (compatibilidade com vers√µes antigas)
                    moments = moments.map(m => ({ ...m, text: sanitizeForStorage(m.text) }));
                    saveMoments(moments);
                }

                // --- Photos ---
                let photos = loadPhotos() || [];

                        renderAll();

                        // configurar listener √∫nico do formul√°rio de edi√ß√£o (registra apenas uma vez)
                        const editFormGlobal = document.getElementById('editMomentForm');
                        if(editFormGlobal){
                            editFormGlobal.addEventListener('submit', function(e){
                                e.preventDefault();
                                const id = document.getElementById('editMomentId').value;
                                const title = document.getElementById('editMomentTitle').value.trim();
                                const text = document.getElementById('editMomentText').value.trim();
                                if(!id) return alert('ID inv√°lido');
                                const idx = moments.findIndex(x => x.id === id);
                                if(idx === -1) return alert('Momento n√£o encontrado');
                                moments[idx].title = title || moments[idx].title;
                                // armazenar texto sanitizado (converte \n em <br>)
                                moments[idx].text = sanitizeForStorage(text);
                                saveMoments(moments);
                                // fechar modal de edi√ß√£o e re-render ap√≥s fechamento
                                const modalEl = document.getElementById('editMomentModal');
                                const bs = bootstrap.Modal.getInstance(modalEl) || new bootstrap.Modal(modalEl);
                                bs.hide();
                                modalEl.addEventListener('hidden.bs.modal', function handler(){
                                    modalEl.removeEventListener('hidden.bs.modal', handler);
                                    renderAll();
                                });
                            });
                        }

                        // add moment (prompts for now)
                addBtn && addBtn.addEventListener('click', ()=>{
                    const title = prompt('T√≠tulo do momento (ex: Primeiro encontro)');
                    if(!title) return;
                    const text = prompt('Descri√ß√£o curta do momento');
                    if(text === null) return;

                    const m = { id: genId(), title: title.trim(), text: sanitizeForStorage(text.trim()) };
                    moments.push(m);
                    saveMoments(moments);
                    renderAll();

                    const bsModal = new bootstrap.Modal(document.getElementById(m.id));
                    bsModal.show();
                });

                // Add photo form handling
                const addPhotoForm = document.getElementById('addPhotoForm');
                const photoFile = document.getElementById('photoFile');
                const photoTitle = document.getElementById('photoTitle');
                const photoPreview = document.getElementById('photoPreview');

                photoFile && photoFile.addEventListener('change', async ()=>{
                    const f = photoFile.files && photoFile.files[0];
                    if(!f) { photoPreview.innerHTML = ''; return; }
                    try{
                        const dataUrl = await fileToDataUrl(f, 1024);
                        photoPreview.innerHTML = `<img src="${dataUrl}" alt="preview" style="max-width:100%;border-radius:8px;"/>`;
                    }catch(e){ photoPreview.innerHTML = '<div class="text-danger">Erro ao carregar imagem</div>'; }
                });

                addPhotoForm && addPhotoForm.addEventListener('submit', async (e)=>{
                    e.preventDefault();
                    const f = photoFile.files && photoFile.files[0];
                    if(!f) return alert('Selecione uma imagem.');
                    try{
                        const dataUrl = await fileToDataUrl(f, 1024);
                        const p = { id: genPhotoId(), title: (photoTitle.value||'').trim(), dataUrl };
                        photos.push(p);
                        savePhotos(photos);
                        renderAll();
                        // fechar modal
                        const modalEl = document.getElementById('addPhotoModal');
                        const bs = bootstrap.Modal.getInstance(modalEl) || new bootstrap.Modal(modalEl);
                        bs.hide();
                        addPhotoForm.reset(); photoPreview.innerHTML = '';
                    }catch(err){ alert('Erro ao processar imagem.'); console.error(err); }
                });

                // render both timeline and gallery
                function renderAll(){
                    renderTimeline();
                    renderGallery();
                }

                // timeline render
                function renderTimeline(){
                    timeline.innerHTML = '';
                    document.querySelectorAll('.generated-moment-modal').forEach(el => el.remove());

                    moments.forEach((m, idx) => {
                        const btn = document.createElement('button');
                        btn.className = 'timeline-point';
                        btn.setAttribute('data-bs-toggle','modal');
                        btn.setAttribute('data-bs-target','#'+m.id);
                        btn.setAttribute('aria-label', m.title || `Momento ${idx+1}`);
                        btn.innerHTML = '<span>' + (idx+1) + '</span>';
                        timeline.appendChild(btn);

                        const modalWrap = document.createElement('div');
                        modalWrap.className = 'modal fade generated-moment-modal';
                        modalWrap.id = m.id;
                        modalWrap.tabIndex = -1;
                        modalWrap.setAttribute('aria-hidden','true');
                        modalWrap.innerHTML = `
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">${escapeHtml(m.title)}</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                                    </div>
                                    <div class="modal-body">${m.text}</div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-outline-primary btn-sm me-2" data-action-edit="${m.id}">Editar</button>
                                        <button type="button" class="btn btn-danger btn-sm me-auto" data-action-delete="${m.id}">Excluir</button>
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                                    </div>
                                </div>
                            </div>`;

                        document.body.appendChild(modalWrap);
                    });

                                // excluir: delega√ß√£o para remover momento
                                document.querySelectorAll('[data-action-delete]').forEach(btn => {
                                    btn.addEventListener('click', (e)=>{
                                        const id = btn.getAttribute('data-action-delete');
                                        if(!id) return;
                                        if(!confirm('Remover este momento?')) return;
                                        // fechar o modal primeiro para evitar backdrop preso
                                        const modalEl = document.getElementById(id);
                                        try{
                                            const bs = bootstrap.Modal.getInstance(modalEl) || new bootstrap.Modal(modalEl);
                                            bs.hide();
                                            // s√≥ remover depois que o modal for totalmente fechado
                                            modalEl.addEventListener('hidden.bs.modal', function handler(){
                                                modalEl.removeEventListener('hidden.bs.modal', handler);
                                                moments = moments.filter(x => x.id !== id);
                                                saveMoments(moments);
                                                renderAll();
                                            });
                                        }catch(err){
                                            // fallback: remover imediatamente
                                            moments = moments.filter(x => x.id !== id);
                                            saveMoments(moments);
                                            renderAll();
                                        }
                                    });
                                });

                                // editar: delega√ß√£o para abrir modal de edi√ß√£o (registrado separadamente)
                                document.querySelectorAll('[data-action-edit]').forEach(btn => {
                                    btn.addEventListener('click', (e)=>{
                                        const id = btn.getAttribute('data-action-edit');
                                        if(!id) return;
                                        const momentObj = moments.find(x => x.id === id);
                                        if(!momentObj) return alert('Momento n√£o encontrado');
                                        // popular modal de edi√ß√£o
                                        const editId = document.getElementById('editMomentId');
                                        const editTitle = document.getElementById('editMomentTitle');
                                        const editText = document.getElementById('editMomentText');
                                        editId.value = momentObj.id;
                                        editTitle.value = momentObj.title;
                                        editText.value = momentObj.text.replace(/<br\s*\/?>/g, '\n');
                                        const modalEl = document.getElementById('editMomentModal');
                                        const momentModalEl = document.getElementById(id);
                                        try{
                                            // fechar modal atual (momento) antes de abrir o de edi√ß√£o
                                            const momBs = bootstrap.Modal.getInstance(momentModalEl) || new bootstrap.Modal(momentModalEl);
                                            momBs.hide();
                                            momentModalEl.addEventListener('hidden.bs.modal', function handler(){
                                                momentModalEl.removeEventListener('hidden.bs.modal', handler);
                                                const bs = new bootstrap.Modal(modalEl);
                                                bs.show();
                                            });
                                        }catch(e){
                                            const bs = new bootstrap.Modal(modalEl);
                                            bs.show();
                                        }
                                    });
                                });
                }

                // gallery render
                function renderGallery(){
                    const gallery = document.getElementById('photoGallery');
                    if(!gallery) return;
                    gallery.innerHTML = '';
                    document.querySelectorAll('.generated-photo-modal').forEach(el => el.remove());

                    photos.forEach((p, idx) => {
                        const wrap = document.createElement('div');
                        wrap.className = 'photo-item';

                        const btn = document.createElement('button');
                        btn.className = 'btn p-0 border-0 bg-transparent';
                        btn.setAttribute('data-bs-toggle','modal');
                        btn.setAttribute('data-bs-target','#' + p.id);
                        btn.innerHTML = `<img src="${p.dataUrl}" alt="${escapeHtml(p.title)}" class="photo-thumb"/>`;

                        wrap.appendChild(btn);
                        gallery.appendChild(wrap);

                        // modal for photo
                        const modalWrap = document.createElement('div');
                        modalWrap.className = 'modal fade generated-photo-modal';
                        modalWrap.id = p.id;
                        modalWrap.tabIndex = -1;
                        modalWrap.setAttribute('aria-hidden','true');
                        modalWrap.innerHTML = `
                            <div class="modal-dialog modal-dialog-centered modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">${escapeHtml(p.title || 'Foto')}</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                                    </div>
                                    <div class="modal-body text-center">
                                        <img src="${p.dataUrl}" alt="${escapeHtml(p.title)}" style="max-width:100%;border-radius:8px;"/>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-danger" data-action-delete-photo="${p.id}">Excluir</button>
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                                    </div>
                                </div>
                            </div>`;

                        document.body.appendChild(modalWrap);
                    });

                                document.querySelectorAll('[data-action-delete-photo]').forEach(btn => {
                                    btn.addEventListener('click', (e)=>{
                                        const id = btn.getAttribute('data-action-delete-photo');
                                        if(!id) return;
                                        if(!confirm('Remover esta foto?')) return;
                                        const modalEl = document.getElementById(id);
                                        try{
                                            const bs = bootstrap.Modal.getInstance(modalEl) || new bootstrap.Modal(modalEl);
                                            bs.hide();
                                            modalEl.addEventListener('hidden.bs.modal', function handler(){
                                                modalEl.removeEventListener('hidden.bs.modal', handler);
                                                photos = photos.filter(x => x.id !== id);
                                                savePhotos(photos);
                                                renderAll();
                                            });
                                        }catch(err){
                                            photos = photos.filter(x => x.id !== id);
                                            savePhotos(photos);
                                            renderAll();
                                        }
                                    });
                                });
                }

                // storage helpers
                function saveMoments(list){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); } catch(e){ console.warn('Falha ao salvar localStorage', e); } }
                function loadMoments(){ try{ const raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : null; } catch(e){ console.warn('Falha ao carregar localStorage', e); return null; } }

                function savePhotos(list){ try{ localStorage.setItem(PHOTO_KEY, JSON.stringify(list)); } catch(e){ console.warn('Falha ao salvar photos', e); } }
                function loadPhotos(){ try{ const raw = localStorage.getItem(PHOTO_KEY); return raw ? JSON.parse(raw) : null; } catch(e){ console.warn('Falha ao carregar photos', e); return null; } }

                function genId(){ return 'm-' + Date.now() + '-' + Math.floor(Math.random()*1000); }
                function genPhotoId(){ return 'p-' + Date.now() + '-' + Math.floor(Math.random()*1000); }

                // resize image and get dataURL (reduces localStorage size)
                function fileToDataUrl(file, maxDim){
                    return new Promise((res, rej)=>{
                        const fr = new FileReader();
                        fr.onload = ()=>{
                            const img = new Image();
                            img.onload = ()=>{
                                let w = img.width; let h = img.height; let scale = 1;
                                if(maxDim && (w > maxDim || h > maxDim)) scale = maxDim / Math.max(w,h);
                                const canvas = document.createElement('canvas');
                                canvas.width = Math.round(w * scale);
                                canvas.height = Math.round(h * scale);
                                const ctx = canvas.getContext('2d');
                                ctx.drawImage(img,0,0,canvas.width,canvas.height);
                                res(canvas.toDataURL('image/jpeg', 0.85));
                            };
                            img.onerror = rej;
                            img.src = fr.result;
                        };
                        fr.onerror = rej;
                        fr.readAsDataURL(file);
                    });
                }

                function escapeHtml(str){ return String(str || '').replace(/&/g, '&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;'); }
            })();
        </script>
                <script>
                    // Compartilhamento: copiar link e gerar QR para window.location.href
                    (function(){
                        const qrModal = document.getElementById('qrModal');
                        const shareUrlInput = document.getElementById('shareUrl');
                        const qrImage = document.getElementById('qrImage');
                        const copyLinkBtn = document.getElementById('copyLinkBtn');
                        const downloadLink = document.getElementById('downloadQr');
                        const qrWarning = document.getElementById('qrWarning');

                        if(!qrModal) return;

                        qrModal.addEventListener('show.bs.modal', function(){
                            // prefer current location href
                            const url = window.location.href;
                            shareUrlInput.value = url;
                            // if file protocol, warn user
                            if(window.location.protocol === 'file:'){
                                qrWarning.classList.remove('d-none');
                            } else {
                                qrWarning.classList.add('d-none');
                            }
                            // generate qr via public API as fallback (no lib). If offline, QR may not load.
                            try{
                                const qrSrc = 'https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=' + encodeURIComponent(url);
                                qrImage.src = qrSrc;
                                downloadLink.href = qrSrc;
                            }catch(e){
                                qrImage.src = '';
                                downloadLink.removeAttribute('href');
                            }
                        });

                        copyLinkBtn && copyLinkBtn.addEventListener('click', async ()=>{
                            const text = shareUrlInput.value;
                            try{
                                await navigator.clipboard.writeText(text);
                                copyLinkBtn.textContent = 'Copiado!';
                                setTimeout(()=> copyLinkBtn.textContent = 'Copiar link', 1500);
                            }catch(e){
                                alert('N√£o foi poss√≠vel copiar automaticamente. Copie manualmente: ' + text);
                            }
                        });
                    })();
                </script>
    </body>
</html>